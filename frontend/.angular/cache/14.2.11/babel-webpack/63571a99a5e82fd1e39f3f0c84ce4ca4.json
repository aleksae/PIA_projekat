{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/ea200304d/Desktop/ETF/rti.PIA/projekat/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nlet KlijentPocetnaComponent = class KlijentPocetnaComponent {\n  constructor(korisnikService, http, broadcastService, router, route) {\n    this.korisnikService = korisnikService;\n    this.http = http;\n    this.broadcastService = broadcastService;\n    this.router = router;\n    this.route = route;\n    this.img_err = false;\n    this.filename_server = \"\";\n    this.slanje_u_toku = false;\n    this.postoji_mejl = false;\n  }\n\n  fileChange(element) {\n    this.uploadedFiles = element.target.files;\n    let event = element;\n    let reader = new FileReader();\n\n    if (event.target.files && event.target.files.length) {\n      const [file] = event.target.files;\n      reader.readAsDataURL(file);\n\n      reader.onload = () => {\n        this.imageSrc = reader.result;\n      };\n\n      let img = new Image();\n      img.src = window.URL.createObjectURL(event.target.files[0]);\n\n      img.onload = () => {\n        this.img_w = img.width;\n        this.img_h = img.height;\n        let val = this.img_h > 300 || this.img_h < 100 || this.img_w < 100 || this.img_w > 300;\n        this.greska = val ? \"слика није одговарајуће величоне\" : null;\n\n        if (val) {\n          this.imageSrc = null;\n          this.uploadedFiles = null;\n          this.img_err = true;\n        } else {\n          this.img_err = false;\n        }\n      };\n    } else {\n      this.uploadedFiles = null;\n      this.imageSrc = null;\n    }\n  }\n\n  ngOnInit() {\n    this.korisnikService.sviKorisnici().subscribe(kIzBaze => {\n      this.korisnici = kIzBaze;\n    });\n    this.ulogovan = JSON.parse(localStorage.getItem(\"klijent\")) || JSON.parse(localStorage.getItem(\"agencija\"));\n    this.ime = this.ulogovan.dodatno.ime;\n    this.prezime = this.ulogovan.dodatno.prezime;\n    this.mejl = this.ulogovan.imejl;\n    this.telefon = this.ulogovan.br_telefona;\n  }\n\n  format_mejl() {\n    if (this.greska) this.greska != null;\n    return /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/.test(this.mejl);\n  }\n\n  check() {\n    if (this.greska) this.greska != null;\n    let set_in_iter_mejl = false;\n    if (!this.korisnici) return;\n    this.korisnici.forEach(clan => {\n      if (clan.imejl == this.mejl && clan.korisnicko_ime != this.ulogovan.korisnicko_ime) {\n        this.postoji_mejl = true;\n        set_in_iter_mejl = true;\n      } else if (!set_in_iter_mejl) this.postoji_mejl = false;\n    });\n    return;\n  }\n\n  obrisi_sliku() {\n    this.http.get('http://localhost:4000/brisanje_slike/' + this.ulogovan.profilna_slika).subscribe(res => {});\n    this.korisnikService.azuriraj_klijenta(this.ulogovan.korisnicko_ime, this.ime, this.prezime, this.telefon, this.mejl, \"\").subscribe(respObj => {});\n    this.azuriraj_ulogovan(\"\");\n  }\n\n  azuriraj_ulogovan(prof) {\n    this.ulogovan.dodatno['ime'] = this.ime;\n    this.ulogovan.dodatno['prezime'] = this.prezime;\n    this.ulogovan.br_telefona = this.telefon;\n    this.ulogovan.imejl = this.mejl;\n    this.ulogovan.profilna_slika = prof;\n    localStorage.removeItem(\"klijent\");\n    localStorage.setItem(\"klijent\", JSON.stringify(this.ulogovan));\n    this.broadcastService.azurirajUlogovanog.next({\n      status: 1\n    });\n    this.ngOnInit();\n    this.uploadedFiles = null;\n    this.imageSrc = null;\n    setTimeout(() => {\n      this.poruka_o_stanju = null;\n    }, 5000);\n  }\n\n  azuriraj() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      if (_this.postoji_mejl || !_this.ime || !_this.prezime || !_this.telefon || !_this.mejl || !_this.format_mejl() || _this.img_err) {\n        _this.greska = \"Неисправно унети подаци!\";\n        return;\n      }\n\n      _this.slanje_u_toku = true;\n\n      if (_this.uploadedFiles) {\n        if (_this.uploadedFiles.length != 0) {\n          let formData = new FormData();\n\n          for (var i = 0; i < _this.uploadedFiles.length; i++) {\n            formData.append(\"uploads[]\", _this.uploadedFiles[i], _this.uploadedFiles[i].name);\n          }\n\n          yield _this.http.post('http://localhost:4000/fajlovi/otpremanje', formData).subscribe( /*#__PURE__*/function () {\n            var _ref = _asyncToGenerator(function* (response) {\n              if (_this.ulogovan.profilna_slika != '') yield _this.http.get('http://localhost:4000/brisanje_slike/' + _this.ulogovan.profilna_slika).subscribe();\n              _this.filename_server = response.fileName;\n\n              _this.korisnikService.azuriraj_klijenta(_this.ulogovan.korisnicko_ime, _this.ime, _this.prezime, _this.telefon, _this.mejl, _this.filename_server).subscribe( /*#__PURE__*/function () {\n                var _ref2 = _asyncToGenerator(function* (respObj) {\n                  if (respObj['message'] == \"ok\") {\n                    window.scroll({\n                      top: 0,\n                      left: 0,\n                      behavior: 'smooth'\n                    });\n                    _this.slanje_u_toku = false;\n                    _this.poruka_o_stanju = \"Подаци успешно ажурирани\";\n\n                    _this.azuriraj_ulogovan(_this.filename_server);\n                  }\n                });\n\n                return function (_x2) {\n                  return _ref2.apply(this, arguments);\n                };\n              }());\n            });\n\n            return function (_x) {\n              return _ref.apply(this, arguments);\n            };\n          }());\n        } else {\n          _this.korisnikService.azuriraj_klijenta(_this.ulogovan.korisnicko_ime, _this.ime, _this.prezime, _this.telefon, _this.mejl, _this.ulogovan.profilna_slika).subscribe( /*#__PURE__*/function () {\n            var _ref3 = _asyncToGenerator(function* (respObj) {\n              if (respObj['message'] == \"ok\") {\n                window.scroll({\n                  top: 0,\n                  left: 0,\n                  behavior: 'smooth'\n                });\n                _this.slanje_u_toku = false;\n                _this.poruka_o_stanju = \"Подаци успешно ажурирани\";\n\n                _this.azuriraj_ulogovan(_this.ulogovan.profilna_slika);\n              } else {}\n            });\n\n            return function (_x3) {\n              return _ref3.apply(this, arguments);\n            };\n          }());\n        }\n      } else {\n        _this.korisnikService.azuriraj_klijenta(_this.ulogovan.korisnicko_ime, _this.ime, _this.prezime, _this.telefon, _this.mejl, _this.ulogovan.profilna_slika).subscribe( /*#__PURE__*/function () {\n          var _ref4 = _asyncToGenerator(function* (respObj) {\n            if (respObj['message'] == \"ok\") {\n              window.scroll({\n                top: 0,\n                left: 0,\n                behavior: 'smooth'\n              });\n              _this.slanje_u_toku = false;\n              _this.poruka_o_stanju = \"Подаци успешно ажурирани\";\n\n              _this.azuriraj_ulogovan(_this.ulogovan.profilna_slika);\n            }\n          });\n\n          return function (_x4) {\n            return _ref4.apply(this, arguments);\n          };\n        }());\n      }\n    })();\n  }\n\n};\nKlijentPocetnaComponent = __decorate([Component({\n  selector: 'app-klijent-pocetna',\n  templateUrl: './klijent-pocetna.component.html',\n  styleUrls: ['./klijent-pocetna.component.css']\n})], KlijentPocetnaComponent);\nexport { KlijentPocetnaComponent };","map":{"version":3,"mappings":"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","names":["Component","KlijentPocetnaComponent","constructor","korisnikService","http","broadcastService","router","route","fileChange","element","uploadedFiles","target","files","event","reader","FileReader","length","file","readAsDataURL","onload","imageSrc","result","img","Image","src","window","URL","createObjectURL","img_w","width","img_h","height","val","greska","img_err","ngOnInit","sviKorisnici","subscribe","kIzBaze","korisnici","ulogovan","JSON","parse","localStorage","getItem","ime","dodatno","prezime","mejl","imejl","telefon","br_telefona","format_mejl","test","check","set_in_iter_mejl","forEach","clan","korisnicko_ime","postoji_mejl","obrisi_sliku","get","profilna_slika","res","azuriraj_klijenta","respObj","azuriraj_ulogovan","prof","removeItem","setItem","stringify","azurirajUlogovanog","next","status","setTimeout","poruka_o_stanju","azuriraj","slanje_u_toku","formData","FormData","i","append","name","post","response","filename_server","fileName","scroll","top","left","behavior","selector","templateUrl","styleUrls"],"sourceRoot":"","sources":["C:\\Users\\ea200304d\\Desktop\\ETF\\rti.PIA\\projekat\\frontend\\src\\app\\klijent-pocetna\\klijent-pocetna.component.ts"],"sourcesContent":["import { Component, EventEmitter, OnInit, Output } from '@angular/core';\nimport { Korisnik } from '../models/korisnik';\nimport { KorisnikService } from '../korisnik.service';\nimport { HttpClient } from '@angular/common/http';\nimport { BroadcastService } from '../broadcast.service';\n\n@Component({\n  selector: 'app-klijent-pocetna',\n  templateUrl: './klijent-pocetna.component.html',\n  styleUrls: ['./klijent-pocetna.component.css']\n})\nexport class KlijentPocetnaComponent implements OnInit {\n\n  constructor(private korisnikService: KorisnikService, private http:HttpClient, private broadcastService: BroadcastService,\n    private router:Router, private route: ActivatedRoute) { \n\n  }\n\n  //fu\n  greska:string;\n  uploadedFiles: Array < File > ;\n  imageSrc: string;\n  img_w:number;\n  img_h:number;\n  img_err:boolean =false;\n  filename_server : string = \"\";\n  slanje_u_toku : boolean = false;\n  \n  fileChange(element) {\n    this.uploadedFiles = element.target.files;\n    \n    let event = element;\n    let reader = new FileReader();\n    \n    if(event.target.files && event.target.files.length) {\n      const [file] = event.target.files;\n      reader.readAsDataURL(file);\n    \n      reader.onload = () => {\n   \n        this.imageSrc = reader.result as string;\n        \n   \n      };\n      \n      let img = new Image()\n      img.src = window.URL.createObjectURL(event.target.files[0])\n      img.onload = () => {\n        this.img_w = img.width;\n        this.img_h = img.height;\n        let val = (this.img_h > 300 ||this.img_h <100 || this.img_w <100 || this.img_w >300 ) \n        this.greska =val? \"слика није одговарајуће величоне\" : null\n        if(val){\n          this.imageSrc = null;\n          this.uploadedFiles=null;\n          this.img_err = true;\n        }else{\n          this.img_err = false;\n          \n        }\n      }\n      \n    }else{\n      this.uploadedFiles = null;\n      this.imageSrc = null;\n    }\n \n\n  \n    \n  }\n  //endfu\n  ulogovan: any;\n  ime: string;\n  prezime: string;\n  telefon: number;\n  mejl: string;\n  korisnici: Korisnik[]\n  postoji_mejl:boolean=false;\n  poruka_o_stanju:string;\n  k_iz_rute:string;\n  ngOnInit(): void {\n    this.korisnikService.sviKorisnici().subscribe((kIzBaze: Korisnik[])=>{\n      this.korisnici = kIzBaze;\n    })\n    this.ulogovan = JSON.parse(localStorage.getItem(\"klijent\")) || JSON.parse(localStorage.getItem(\"agencija\"));\n    this.ime = this.ulogovan.dodatno.ime;\n    this.prezime = this.ulogovan.dodatno.prezime\n    this.mejl = this.ulogovan.imejl\n    this.telefon = this.ulogovan.br_telefona\n  }\n  format_mejl(){\n    if(this.greska) this.greska!=null;\n    return /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/.test(this.mejl);\n  }\n  check() {\n    if(this.greska) this.greska!=null;\n    let set_in_iter_mejl = false;\n    \n      if(!this.korisnici) return;\n      this.korisnici.forEach( (clan)=>{\n        \n        if(clan.imejl==this.mejl && clan.korisnicko_ime!=this.ulogovan.korisnicko_ime){\n          this.postoji_mejl = true;\n          set_in_iter_mejl = true;\n        }\n        else if(!set_in_iter_mejl)  this.postoji_mejl  = false;\n      \n    }\n    )\n    return ;\n  }\n  obrisi_sliku(){\n    this.http.get('http://localhost:4000/brisanje_slike/'+this.ulogovan.profilna_slika).subscribe((res)=>{\n    })\n    this.korisnikService.azuriraj_klijenta(this.ulogovan.korisnicko_ime, this.ime, this.prezime, this.telefon, this.mejl,\"\").subscribe(respObj=>{\n    })\n    this.azuriraj_ulogovan(\"\") \n  }\n\n  azuriraj_ulogovan(prof){\n    this.ulogovan.dodatno['ime'] = this.ime;\n    this.ulogovan.dodatno['prezime'] = this.prezime;\n    this.ulogovan.br_telefona = this.telefon;\n    this.ulogovan.imejl = this.mejl\n    this.ulogovan.profilna_slika = prof;\n    localStorage.removeItem(\"klijent\");\n   \n    localStorage.setItem(\"klijent\", JSON.stringify(this.ulogovan));\n    this.broadcastService.azurirajUlogovanog.next({ status: 1 });\n    this.ngOnInit();\n    this.uploadedFiles = null;\n    this.imageSrc = null;\n    setTimeout(()=>{\n      this.poruka_o_stanju = null\n    }, 5000)\n\n  }\n  async azuriraj(){\n    if(((this.postoji_mejl)  || !this.ime || !this.prezime || !this.telefon || !this.mejl ||!this.format_mejl() || this.img_err)){\n      this.greska = \"Неисправно унети подаци!\";\n      return;\n    }\n\n    this.slanje_u_toku = true;\n    if(this.uploadedFiles){\n      if(this.uploadedFiles.length!=0){\n        interface responseExtended extends Response{\n          fileName:any;\n        }\n        let formData = new FormData();\n        for (var i = 0; i < this.uploadedFiles.length; i++) {\n            formData.append(\"uploads[]\", this.uploadedFiles[i], this.uploadedFiles[i].name);\n        }\n        \n      \n       \n        await this.http.post('http://localhost:4000/fajlovi/otpremanje', formData)\n            .subscribe(async (response : responseExtended) => {\n                if(this.ulogovan.profilna_slika!='')await this.http.get('http://localhost:4000/brisanje_slike/'+this.ulogovan.profilna_slika).subscribe();\n                this.filename_server =  response.fileName;\n                this.korisnikService.azuriraj_klijenta(this.ulogovan.korisnicko_ime,this.ime, this.prezime, this.telefon, this.mejl, this.filename_server).subscribe(async respObj=>{\n                  if(respObj['message']==\"ok\") {\n                    window.scroll({ \n                      top: 0, \n                      left: 0, \n                      behavior: 'smooth' \n                    });\n                    this.slanje_u_toku = false;\n                    this.poruka_o_stanju = \"Подаци успешно ажурирани\";\n                    this.azuriraj_ulogovan(this.filename_server)\n                  }\n                });\n            })\n      }\n      else{\n\n        this.korisnikService.azuriraj_klijenta(this.ulogovan.korisnicko_ime, this.ime, this.prezime, this.telefon, this.mejl, this.ulogovan.profilna_slika).subscribe(async respObj=>{\n          if(respObj['message']==\"ok\") {\n            window.scroll({ \n              top: 0, \n              left: 0, \n              behavior: 'smooth' \n            });\n            this.slanje_u_toku = false;\n            this.poruka_o_stanju = \"Подаци успешно ажурирани\";\n            this.azuriraj_ulogovan(this.ulogovan.profilna_slika)\n          }else{\n          }\n        });\n      }\n    }else{\n\n    this.korisnikService.azuriraj_klijenta(this.ulogovan.korisnicko_ime,this.ime, this.prezime, this.telefon, this.mejl,  this.ulogovan.profilna_slika).subscribe(async respObj=>{\n      if(respObj['message']==\"ok\") {\n        window.scroll({ \n          top: 0, \n          left: 0, \n          behavior: 'smooth' \n        });\n        this.slanje_u_toku = false;\n        this.poruka_o_stanju = \"Подаци успешно ажурирани\";\n        this.azuriraj_ulogovan(this.ulogovan.profilna_slika)\n      }\n    });\n  }\n  }\n\n}\n"]},"metadata":{},"sourceType":"module"}