{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/ea200304d/Desktop/ETF/rti.PIA/projekat/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nlet AgencijaProfilComponent = class AgencijaProfilComponent {\n  constructor(korisnikService, http, broadcastService, router, route) {\n    this.korisnikService = korisnikService;\n    this.http = http;\n    this.broadcastService = broadcastService;\n    this.router = router;\n    this.route = route;\n    this.img_err = false;\n    this.filename_server = \"\";\n    this.slanje_u_toku = false;\n    this.postoji_mejl = false;\n  }\n\n  fileChange(element) {\n    this.uploadedFiles = element.target.files;\n    let event = element;\n    let reader = new FileReader();\n\n    if (event.target.files && event.target.files.length) {\n      const [file] = event.target.files;\n      reader.readAsDataURL(file);\n\n      reader.onload = () => {\n        this.imageSrc = reader.result;\n      };\n\n      let img = new Image();\n      img.src = window.URL.createObjectURL(event.target.files[0]);\n\n      img.onload = () => {\n        this.img_w = img.width;\n        this.img_h = img.height;\n        let val = this.img_h > 300 || this.img_h < 100 || this.img_w < 100 || this.img_w > 300;\n        this.greska = val ? \"слика није одговарајуће величоне\" : null;\n\n        if (val) {\n          this.imageSrc = null;\n          this.uploadedFiles = null;\n          this.img_err = true;\n        } else {\n          this.img_err = false;\n        }\n      };\n    } else {\n      this.uploadedFiles = null;\n      this.imageSrc = null;\n    }\n  }\n\n  ngOnInit() {\n    this.route.paramMap.subscribe(params => {\n      this.k_iz_rute = params.get('id');\n    });\n    this.korisnikService.sviKorisnici().subscribe(kIzBaze => {\n      this.korisnici = kIzBaze;\n    });\n\n    if (this.router.url.indexOf('admin') > -1) {} else this.ulogovan = JSON.parse(localStorage.getItem(\"klijent\")) || JSON.parse(localStorage.getItem(\"agencija\"));\n\n    this.naziv = this.ulogovan.dodatno.naziv;\n    this.opis = this.ulogovan.dodatno.opis;\n    this.adresa = this.ulogovan.dodatno.adresa;\n    this.mejl = this.ulogovan.imejl;\n    this.telefon = this.ulogovan.br_telefona;\n  }\n\n  format_mejl() {\n    if (this.greska) this.greska != null;\n    return /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/.test(this.mejl);\n  }\n\n  check() {\n    if (this.greska) this.greska != null;\n    let set_in_iter_mejl = false;\n    if (!this.korisnici) return;\n    this.korisnici.forEach(clan => {\n      if (clan.imejl == this.mejl && clan.korisnicko_ime != this.ulogovan.korisnicko_ime) {\n        this.postoji_mejl = true;\n        set_in_iter_mejl = true;\n      } else if (!set_in_iter_mejl) this.postoji_mejl = false;\n    });\n    return;\n  }\n\n  azuriraj_ulogovan(prof) {\n    console.log(\"alskesa\");\n    this.ulogovan.dodatno['naziv'] = this.naziv;\n    this.ulogovan.dodatno['adresa'] = this.adresa;\n    this.ulogovan.dodatno['opis'] = this.opis;\n    this.ulogovan.br_telefona = this.telefon;\n    this.ulogovan.imejl = this.mejl;\n    this.ulogovan.profilna_slika = prof;\n    localStorage.removeItem(\"agencija\");\n    localStorage.setItem(\"agencija\", JSON.stringify(this.ulogovan));\n    this.broadcastService.azurirajUlogovanog.next({\n      status: 1\n    });\n    this.ngOnInit();\n    this.uploadedFiles = null;\n    this.imageSrc = null;\n    setTimeout(() => {\n      this.poruka_o_stanju = null;\n    }, 5000);\n  }\n\n  obrisi_sliku() {\n    this.http.get('http://localhost:4000/brisanje_slike/' + this.ulogovan.profilna_slika).subscribe(res => {});\n    this.korisnikService.azuriraj_agenciju(this.ulogovan.korisnicko_ime, this.naziv, this.adresa, this.opis, this.ulogovan.dodatno['maticni_broj'], this.telefon, this.mejl, \"\").subscribe(respObj => {});\n    this.azuriraj_ulogovan(\"\");\n  }\n\n  azuriraj() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      if (_this.postoji_mejl || !_this.naziv || !_this.adresa || !_this.opis || !_this.telefon || !_this.mejl || !_this.format_mejl() || _this.img_err) {\n        _this.greska = \"Неисправно унети подаци!\";\n        console.log(_this.postoji_mejl);\n        console.log(!_this.naziv);\n        console.log(!_this.adresa);\n        console.log(!_this.opis);\n        console.log(!_this.telefon);\n        console.log(!_this.mejl);\n        console.log(!_this.format_mejl());\n        console.log(_this.img_err);\n        return;\n      }\n\n      _this.slanje_u_toku = true;\n\n      if (_this.uploadedFiles) {\n        if (_this.uploadedFiles.length != 0) {\n          let formData = new FormData();\n\n          for (var i = 0; i < _this.uploadedFiles.length; i++) {\n            formData.append(\"uploads[]\", _this.uploadedFiles[i], _this.uploadedFiles[i].name);\n          }\n\n          yield _this.http.post('http://localhost:4000/fajlovi/otpremanje', formData).subscribe( /*#__PURE__*/function () {\n            var _ref = _asyncToGenerator(function* (response) {\n              if (_this.ulogovan.profilna_slika != '') yield _this.http.get('http://localhost:4000/brisanje_slike/' + _this.ulogovan.profilna_slika).subscribe();\n              _this.filename_server = response.fileName;\n\n              _this.korisnikService.azuriraj_agenciju(_this.ulogovan.korisnicko_ime, _this.naziv, _this.adresa, _this.opis, _this.ulogovan.dodatno['maticni_broj'], _this.telefon, _this.mejl, _this.filename_server).subscribe( /*#__PURE__*/function () {\n                var _ref2 = _asyncToGenerator(function* (respObj) {\n                  if (respObj['message'] == \"ok\") {\n                    window.scroll({\n                      top: 0,\n                      left: 0,\n                      behavior: 'smooth'\n                    });\n                    _this.slanje_u_toku = false;\n                    _this.poruka_o_stanju = \"Подаци успешно ажурирани\";\n\n                    _this.azuriraj_ulogovan(_this.filename_server);\n                  }\n                });\n\n                return function (_x2) {\n                  return _ref2.apply(this, arguments);\n                };\n              }());\n            });\n\n            return function (_x) {\n              return _ref.apply(this, arguments);\n            };\n          }());\n        } else {\n          _this.korisnikService.azuriraj_agenciju(_this.ulogovan.korisnicko_ime, _this.naziv, _this.adresa, _this.opis, _this.ulogovan.dodatno['maticni_broj'], _this.telefon, _this.mejl, _this.ulogovan.profilna_slika).subscribe( /*#__PURE__*/function () {\n            var _ref3 = _asyncToGenerator(function* (respObj) {\n              if (respObj['message'] == \"ok\") {\n                window.scroll({\n                  top: 0,\n                  left: 0,\n                  behavior: 'smooth'\n                });\n                _this.slanje_u_toku = false;\n                _this.poruka_o_stanju = \"Подаци успешно ажурирани\";\n\n                _this.azuriraj_ulogovan(_this.ulogovan.profilna_slika);\n              } else {}\n            });\n\n            return function (_x3) {\n              return _ref3.apply(this, arguments);\n            };\n          }());\n        }\n      } else {\n        _this.korisnikService.azuriraj_agenciju(_this.ulogovan.korisnicko_ime, _this.naziv, _this.adresa, _this.opis, _this.ulogovan.dodatno['maticni_broj'], _this.telefon, _this.mejl, _this.ulogovan.profilna_slika).subscribe( /*#__PURE__*/function () {\n          var _ref4 = _asyncToGenerator(function* (respObj) {\n            if (respObj['message'] == \"ok\") {\n              window.scroll({\n                top: 0,\n                left: 0,\n                behavior: 'smooth'\n              });\n              _this.slanje_u_toku = false;\n              _this.poruka_o_stanju = \"Подаци успешно ажурирани\";\n\n              _this.azuriraj_ulogovan(_this.ulogovan.profilna_slika);\n            }\n          });\n\n          return function (_x4) {\n            return _ref4.apply(this, arguments);\n          };\n        }());\n      }\n    })();\n  }\n\n};\nAgencijaProfilComponent = __decorate([Component({\n  selector: 'app-agencija-profil',\n  templateUrl: './agencija-profil.component.html',\n  styleUrls: ['./agencija-profil.component.css']\n})], AgencijaProfilComponent);\nexport { AgencijaProfilComponent };","map":{"version":3,"mappings":";;AAAA,SAASA,SAAT,QAAwD,eAAxD;AAYA,IAAaC,uBAAuB,GAApC,MAAaA,uBAAb,CAAoC;EAElCC,YAAoBC,eAApB,EAA8DC,IAA9D,EAAuFC,gBAAvF,EACUC,MADV,EACiCC,KADjC,EACsD;IADlC;IAA0C;IAAyB;IAC7E;IAAuB;IAUjC,eAAiB,KAAjB;IACA,uBAA2B,EAA3B;IACA,qBAA0B,KAA1B;IAoDA,oBAAqB,KAArB;EA9DC;;EAYDC,UAAU,CAACC,OAAD,EAAQ;IAChB,KAAKC,aAAL,GAAqBD,OAAO,CAACE,MAAR,CAAeC,KAApC;IAEA,IAAIC,KAAK,GAAGJ,OAAZ;IACA,IAAIK,MAAM,GAAG,IAAIC,UAAJ,EAAb;;IAEA,IAAGF,KAAK,CAACF,MAAN,CAAaC,KAAb,IAAsBC,KAAK,CAACF,MAAN,CAAaC,KAAb,CAAmBI,MAA5C,EAAoD;MAClD,MAAM,CAACC,IAAD,IAASJ,KAAK,CAACF,MAAN,CAAaC,KAA5B;MACAE,MAAM,CAACI,aAAP,CAAqBD,IAArB;;MAEAH,MAAM,CAACK,MAAP,GAAgB,MAAK;QAEnB,KAAKC,QAAL,GAAgBN,MAAM,CAACO,MAAvB;MAGD,CALD;;MAOA,IAAIC,GAAG,GAAG,IAAIC,KAAJ,EAAV;MACAD,GAAG,CAACE,GAAJ,GAAUC,MAAM,CAACC,GAAP,CAAWC,eAAX,CAA2Bd,KAAK,CAACF,MAAN,CAAaC,KAAb,CAAmB,CAAnB,CAA3B,CAAV;;MACAU,GAAG,CAACH,MAAJ,GAAa,MAAK;QAChB,KAAKS,KAAL,GAAaN,GAAG,CAACO,KAAjB;QACA,KAAKC,KAAL,GAAaR,GAAG,CAACS,MAAjB;QACA,IAAIC,GAAG,GAAI,KAAKF,KAAL,GAAa,GAAb,IAAmB,KAAKA,KAAL,GAAY,GAA/B,IAAsC,KAAKF,KAAL,GAAY,GAAlD,IAAyD,KAAKA,KAAL,GAAY,GAAhF;QACA,KAAKK,MAAL,GAAaD,GAAG,GAAE,kCAAF,GAAuC,IAAvD;;QACA,IAAGA,GAAH,EAAO;UACL,KAAKZ,QAAL,GAAgB,IAAhB;UACA,KAAKV,aAAL,GAAmB,IAAnB;UACA,KAAKwB,OAAL,GAAe,IAAf;QACD,CAJD,MAIK;UACH,KAAKA,OAAL,GAAe,KAAf;QAED;MACF,CAbD;IAeD,CA5BD,MA4BK;MACH,KAAKxB,aAAL,GAAqB,IAArB;MACA,KAAKU,QAAL,GAAgB,IAAhB;IACD;EAKF;;EAYDe,QAAQ;IACN,KAAK5B,KAAL,CAAW6B,QAAX,CAAoBC,SAApB,CAA+BC,MAAD,IAAqB;MACjD,KAAKC,SAAL,GAAiBD,MAAM,CAACE,GAAP,CAAW,IAAX,CAAjB;IACD,CAFD;IAGA,KAAKrC,eAAL,CAAqBsC,YAArB,GAAoCJ,SAApC,CAA+CK,OAAD,IAAuB;MACnE,KAAKC,SAAL,GAAiBD,OAAjB;IACD,CAFD;;IAGA,IAAG,KAAKpC,MAAL,CAAYsC,GAAZ,CAAgBC,OAAhB,CAAwB,OAAxB,IAAiC,CAAC,CAArC,EAAwC,CAEvC,CAFD,MAGK,KAAKC,QAAL,GAAgBC,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,OAAb,CAAqB,SAArB,CAAX,KAA+CH,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,OAAb,CAAqB,UAArB,CAAX,CAA/D;;IACL,KAAKC,KAAL,GAAa,KAAKL,QAAL,CAAcM,OAAd,CAAsBD,KAAnC;IACA,KAAKE,IAAL,GAAY,KAAKP,QAAL,CAAcM,OAAd,CAAsBC,IAAlC;IACA,KAAKC,MAAL,GAAc,KAAKR,QAAL,CAAcM,OAAd,CAAsBE,MAApC;IACA,KAAKC,IAAL,GAAY,KAAKT,QAAL,CAAcU,KAA1B;IACA,KAAKC,OAAL,GAAe,KAAKX,QAAL,CAAcY,WAA7B;EACD;;EACDC,WAAW;IACT,IAAG,KAAK1B,MAAR,EAAgB,KAAKA,MAAL,IAAa,IAAb;IAChB,OAAO,gDAAgD2B,IAAhD,CAAqD,KAAKL,IAA1D,CAAP;EACD;;EACDM,KAAK;IACH,IAAG,KAAK5B,MAAR,EAAgB,KAAKA,MAAL,IAAa,IAAb;IAChB,IAAI6B,gBAAgB,GAAG,KAAvB;IAEE,IAAG,CAAC,KAAKnB,SAAT,EAAoB;IACpB,KAAKA,SAAL,CAAeoB,OAAf,CAAyBC,IAAD,IAAQ;MAE9B,IAAGA,IAAI,CAACR,KAAL,IAAY,KAAKD,IAAjB,IAAyBS,IAAI,CAACC,cAAL,IAAqB,KAAKnB,QAAL,CAAcmB,cAA/D,EAA8E;QAC5E,KAAKC,YAAL,GAAoB,IAApB;QACAJ,gBAAgB,GAAG,IAAnB;MACD,CAHD,MAIK,IAAG,CAACA,gBAAJ,EAAuB,KAAKI,YAAL,GAAqB,KAArB;IAE/B,CARC;IAUF;EACD;;EAEDC,iBAAiB,CAACC,IAAD,EAAK;IACpBC,OAAO,CAACC,GAAR,CAAY,SAAZ;IACA,KAAKxB,QAAL,CAAcM,OAAd,CAAsB,OAAtB,IAAiC,KAAKD,KAAtC;IACA,KAAKL,QAAL,CAAcM,OAAd,CAAsB,QAAtB,IAAkC,KAAKE,MAAvC;IACA,KAAKR,QAAL,CAAcM,OAAd,CAAsB,MAAtB,IAAgC,KAAKC,IAArC;IACA,KAAKP,QAAL,CAAcY,WAAd,GAA4B,KAAKD,OAAjC;IACA,KAAKX,QAAL,CAAcU,KAAd,GAAsB,KAAKD,IAA3B;IACA,KAAKT,QAAL,CAAcyB,cAAd,GAA+BH,IAA/B;IACAnB,YAAY,CAACuB,UAAb,CAAwB,UAAxB;IAEAvB,YAAY,CAACwB,OAAb,CAAqB,UAArB,EAAiC1B,IAAI,CAAC2B,SAAL,CAAe,KAAK5B,QAApB,CAAjC;IACA,KAAKzC,gBAAL,CAAsBsE,kBAAtB,CAAyCC,IAAzC,CAA8C;MAAEC,MAAM,EAAE;IAAV,CAA9C;IACA,KAAK1C,QAAL;IACA,KAAKzB,aAAL,GAAqB,IAArB;IACA,KAAKU,QAAL,GAAgB,IAAhB;IACA0D,UAAU,CAAC,MAAI;MACb,KAAKC,eAAL,GAAuB,IAAvB;IACD,CAFS,EAEP,IAFO,CAAV;EAID;;EAEDC,YAAY;IACV,KAAK5E,IAAL,CAAUoC,GAAV,CAAc,0CAAwC,KAAKM,QAAL,CAAcyB,cAApE,EAAoFlC,SAApF,CAA+F4C,GAAD,IAAO,CACpG,CADD;IAEA,KAAK9E,eAAL,CAAqB+E,iBAArB,CAAuC,KAAKpC,QAAL,CAAcmB,cAArD,EAAoE,KAAKd,KAAzE,EAAgF,KAAKG,MAArF,EAA6F,KAAKD,IAAlG,EAAwG,KAAKP,QAAL,CAAcM,OAAd,CAAsB,cAAtB,CAAxG,EAA+I,KAAKK,OAApJ,EAA6J,KAAKF,IAAlK,EAAwK,EAAxK,EAA4KlB,SAA5K,CAAsL8C,OAAO,IAAE,CAC9L,CADD;IAEA,KAAKhB,iBAAL,CAAuB,EAAvB;EACD;;EACKiB,QAAQ;IAAA;;IAAA;MACZ,IAAK,KAAI,CAAClB,YAAN,IAAwB,CAAC,KAAI,CAACf,KAA9B,IAAuC,CAAC,KAAI,CAACG,MAA7C,IAAuD,CAAC,KAAI,CAACD,IAA7D,IAAqE,CAAC,KAAI,CAACI,OAA3E,IAAsF,CAAC,KAAI,CAACF,IAA5F,IAAmG,CAAC,KAAI,CAACI,WAAL,EAApG,IAA0H,KAAI,CAACzB,OAAnI,EAA4I;QAC1I,KAAI,CAACD,MAAL,GAAc,0BAAd;QACAoC,OAAO,CAACC,GAAR,CAAa,KAAI,CAACJ,YAAlB;QACAG,OAAO,CAACC,GAAR,CAAY,CAAE,KAAI,CAACnB,KAAnB;QACAkB,OAAO,CAACC,GAAR,CAAY,CAAE,KAAI,CAAChB,MAAnB;QACAe,OAAO,CAACC,GAAR,CAAY,CAAE,KAAI,CAACjB,IAAnB;QACAgB,OAAO,CAACC,GAAR,CAAY,CAAE,KAAI,CAACb,OAAnB;QACAY,OAAO,CAACC,GAAR,CAAY,CAAE,KAAI,CAACf,IAAnB;QACAc,OAAO,CAACC,GAAR,CAAY,CAAC,KAAI,CAACX,WAAL,EAAb;QACAU,OAAO,CAACC,GAAR,CAAY,KAAI,CAACpC,OAAjB;QACA;MACD;;MAED,KAAI,CAACmD,aAAL,GAAqB,IAArB;;MACA,IAAG,KAAI,CAAC3E,aAAR,EAAsB;QACpB,IAAG,KAAI,CAACA,aAAL,CAAmBM,MAAnB,IAA2B,CAA9B,EAAgC;UAI9B,IAAIsE,QAAQ,GAAG,IAAIC,QAAJ,EAAf;;UACA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAI,CAAC9E,aAAL,CAAmBM,MAAvC,EAA+CwE,CAAC,EAAhD,EAAoD;YAChDF,QAAQ,CAACG,MAAT,CAAgB,WAAhB,EAA6B,KAAI,CAAC/E,aAAL,CAAmB8E,CAAnB,CAA7B,EAAoD,KAAI,CAAC9E,aAAL,CAAmB8E,CAAnB,EAAsBE,IAA1E;UACH;;UAID,MAAM,KAAI,CAACtF,IAAL,CAAUuF,IAAV,CAAe,0CAAf,EAA2DL,QAA3D,EACDjD,SADC;YAAA,6BACS,WAAOuD,QAAP,EAAsC;cAC7C,IAAG,KAAI,CAAC9C,QAAL,CAAcyB,cAAd,IAA8B,EAAjC,EAAoC,MAAM,KAAI,CAACnE,IAAL,CAAUoC,GAAV,CAAc,0CAAwC,KAAI,CAACM,QAAL,CAAcyB,cAApE,EAAoFlC,SAApF,EAAN;cACpC,KAAI,CAACwD,eAAL,GAAwBD,QAAQ,CAACE,QAAjC;;cACA,KAAI,CAAC3F,eAAL,CAAqB+E,iBAArB,CAAuC,KAAI,CAACpC,QAAL,CAAcmB,cAArD,EAAoE,KAAI,CAACd,KAAzE,EAAgF,KAAI,CAACG,MAArF,EAA6F,KAAI,CAACD,IAAlG,EAAwG,KAAI,CAACP,QAAL,CAAcM,OAAd,CAAsB,cAAtB,CAAxG,EAA+I,KAAI,CAACK,OAApJ,EAA6J,KAAI,CAACF,IAAlK,EAAwK,KAAI,CAACsC,eAA7K,EAA8LxD,SAA9L;gBAAA,8BAAwM,WAAM8C,OAAN,EAAe;kBACrN,IAAGA,OAAO,CAAC,SAAD,CAAP,IAAoB,IAAvB,EAA6B;oBAC3B1D,MAAM,CAACsE,MAAP,CAAc;sBACZC,GAAG,EAAE,CADO;sBAEZC,IAAI,EAAE,CAFM;sBAGZC,QAAQ,EAAE;oBAHE,CAAd;oBAKA,KAAI,CAACb,aAAL,GAAqB,KAArB;oBACA,KAAI,CAACN,eAAL,GAAuB,0BAAvB;;oBACA,KAAI,CAACZ,iBAAL,CAAuB,KAAI,CAAC0B,eAA5B;kBACD;gBACF,CAXD;;gBAAA;kBAAA;gBAAA;cAAA;YAYH,CAhBC;;YAAA;cAAA;YAAA;UAAA,IAAN;QAiBD,CA5BD,MA6BI;UAEF,KAAI,CAAC1F,eAAL,CAAqB+E,iBAArB,CAAuC,KAAI,CAACpC,QAAL,CAAcmB,cAArD,EAAqE,KAAI,CAACd,KAA1E,EAAiF,KAAI,CAACG,MAAtF,EAA8F,KAAI,CAACD,IAAnG,EAAyG,KAAI,CAACP,QAAL,CAAcM,OAAd,CAAsB,cAAtB,CAAzG,EAAgJ,KAAI,CAACK,OAArJ,EAA8J,KAAI,CAACF,IAAnK,EAAyK,KAAI,CAACT,QAAL,CAAcyB,cAAvL,EAAuMlC,SAAvM;YAAA,8BAAiN,WAAM8C,OAAN,EAAe;cAC9N,IAAGA,OAAO,CAAC,SAAD,CAAP,IAAoB,IAAvB,EAA6B;gBAC3B1D,MAAM,CAACsE,MAAP,CAAc;kBACZC,GAAG,EAAE,CADO;kBAEZC,IAAI,EAAE,CAFM;kBAGZC,QAAQ,EAAE;gBAHE,CAAd;gBAKA,KAAI,CAACb,aAAL,GAAqB,KAArB;gBACA,KAAI,CAACN,eAAL,GAAuB,0BAAvB;;gBACA,KAAI,CAACZ,iBAAL,CAAuB,KAAI,CAACrB,QAAL,CAAcyB,cAArC;cACD,CATD,MASK,CACJ;YACF,CAZD;;YAAA;cAAA;YAAA;UAAA;QAaD;MACF,CA9CD,MA8CK;QAEL,KAAI,CAACpE,eAAL,CAAqB+E,iBAArB,CAAuC,KAAI,CAACpC,QAAL,CAAcmB,cAArD,EAAoE,KAAI,CAACd,KAAzE,EAAgF,KAAI,CAACG,MAArF,EAA6F,KAAI,CAACD,IAAlG,EAAwG,KAAI,CAACP,QAAL,CAAcM,OAAd,CAAsB,cAAtB,CAAxG,EAA+I,KAAI,CAACK,OAApJ,EAA6J,KAAI,CAACF,IAAlK,EAAyK,KAAI,CAACT,QAAL,CAAcyB,cAAvL,EAAuMlC,SAAvM;UAAA,8BAAiN,WAAM8C,OAAN,EAAe;YAC9N,IAAGA,OAAO,CAAC,SAAD,CAAP,IAAoB,IAAvB,EAA6B;cAC3B1D,MAAM,CAACsE,MAAP,CAAc;gBACZC,GAAG,EAAE,CADO;gBAEZC,IAAI,EAAE,CAFM;gBAGZC,QAAQ,EAAE;cAHE,CAAd;cAKA,KAAI,CAACb,aAAL,GAAqB,KAArB;cACA,KAAI,CAACN,eAAL,GAAuB,0BAAvB;;cACA,KAAI,CAACZ,iBAAL,CAAuB,KAAI,CAACrB,QAAL,CAAcyB,cAArC;YACD;UACF,CAXD;;UAAA;YAAA;UAAA;QAAA;MAYD;IA3Ea;EA4Eb;;AAtNiC,CAApC;AAAatE,uBAAuB,eALnCD,SAAS,CAAC;EACTmG,QAAQ,EAAE,qBADD;EAETC,WAAW,EAAE,kCAFJ;EAGTC,SAAS,EAAE,CAAC,iCAAD;AAHF,CAAD,CAK0B,GAAvBpG,uBAAuB,CAAvB;SAAAA","names":["Component","AgencijaProfilComponent","constructor","korisnikService","http","broadcastService","router","route","fileChange","element","uploadedFiles","target","files","event","reader","FileReader","length","file","readAsDataURL","onload","imageSrc","result","img","Image","src","window","URL","createObjectURL","img_w","width","img_h","height","val","greska","img_err","ngOnInit","paramMap","subscribe","params","k_iz_rute","get","sviKorisnici","kIzBaze","korisnici","url","indexOf","ulogovan","JSON","parse","localStorage","getItem","naziv","dodatno","opis","adresa","mejl","imejl","telefon","br_telefona","format_mejl","test","check","set_in_iter_mejl","forEach","clan","korisnicko_ime","postoji_mejl","azuriraj_ulogovan","prof","console","log","profilna_slika","removeItem","setItem","stringify","azurirajUlogovanog","next","status","setTimeout","poruka_o_stanju","obrisi_sliku","res","azuriraj_agenciju","respObj","azuriraj","slanje_u_toku","formData","FormData","i","append","name","post","response","filename_server","fileName","scroll","top","left","behavior","selector","templateUrl","styleUrls"],"sourceRoot":"","sources":["C:\\Users\\ea200304d\\Desktop\\ETF\\rti.PIA\\projekat\\frontend\\src\\app\\agencija-profil\\agencija-profil.component.ts"],"sourcesContent":["import { Component, EventEmitter, OnInit, Output } from '@angular/core';\nimport { Korisnik } from '../models/korisnik';\nimport { KorisnikService } from '../korisnik.service';\nimport { HttpClient } from '@angular/common/http';\nimport { BroadcastService } from '../broadcast.service';\nimport { ParamMap, Router } from '@angular/router';\n\n@Component({\n  selector: 'app-agencija-profil',\n  templateUrl: './agencija-profil.component.html',\n  styleUrls: ['./agencija-profil.component.css']\n})\nexport class AgencijaProfilComponent implements OnInit {\n\n  constructor(private korisnikService: KorisnikService, private http:HttpClient, private broadcastService: BroadcastService,\n    private router:Router, private route: ActivatedRoute) { \n\n  }\n\n  //fu\n  greska:string;\n  uploadedFiles: Array < File > ;\n  imageSrc: string;\n  img_w:number;\n  img_h:number;\n  img_err:boolean =false;\n  filename_server : string = \"\";\n  slanje_u_toku : boolean = false;\n  \n  fileChange(element) {\n    this.uploadedFiles = element.target.files;\n    \n    let event = element;\n    let reader = new FileReader();\n    \n    if(event.target.files && event.target.files.length) {\n      const [file] = event.target.files;\n      reader.readAsDataURL(file);\n    \n      reader.onload = () => {\n   \n        this.imageSrc = reader.result as string;\n        \n   \n      };\n      \n      let img = new Image()\n      img.src = window.URL.createObjectURL(event.target.files[0])\n      img.onload = () => {\n        this.img_w = img.width;\n        this.img_h = img.height;\n        let val = (this.img_h > 300 ||this.img_h <100 || this.img_w <100 || this.img_w >300 ) \n        this.greska =val? \"слика није одговарајуће величоне\" : null\n        if(val){\n          this.imageSrc = null;\n          this.uploadedFiles=null;\n          this.img_err = true;\n        }else{\n          this.img_err = false;\n          \n        }\n      }\n      \n    }else{\n      this.uploadedFiles = null;\n      this.imageSrc = null;\n    }\n\n\n  \n    \n  }\n  //endfu\n  ulogovan: any;\n  naziv: string;\n  adresa: string;\n  telefon: number;\n  mejl: string;\n  korisnici: Korisnik[]\n  postoji_mejl:boolean=false;\n  poruka_o_stanju:string;\n  opis:string\n  k_iz_rute:string;\n  ngOnInit(): void {\n    this.route.paramMap.subscribe((params: ParamMap) => {\n      this.k_iz_rute = params.get('id')\n    })\n    this.korisnikService.sviKorisnici().subscribe((kIzBaze: Korisnik[])=>{\n      this.korisnici = kIzBaze;\n    })\n    if(this.router.url.indexOf('admin')>-1) {\n\n    }\n    else this.ulogovan = JSON.parse(localStorage.getItem(\"klijent\")) || JSON.parse(localStorage.getItem(\"agencija\"));\n    this.naziv = this.ulogovan.dodatno.naziv;\n    this.opis = this.ulogovan.dodatno.opis\n    this.adresa = this.ulogovan.dodatno.adresa\n    this.mejl = this.ulogovan.imejl\n    this.telefon = this.ulogovan.br_telefona\n  }\n  format_mejl(){\n    if(this.greska) this.greska!=null;\n    return /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/.test(this.mejl);\n  }\n  check() {\n    if(this.greska) this.greska!=null;\n    let set_in_iter_mejl = false;\n    \n      if(!this.korisnici) return;\n      this.korisnici.forEach( (clan)=>{\n        \n        if(clan.imejl==this.mejl && clan.korisnicko_ime!=this.ulogovan.korisnicko_ime){\n          this.postoji_mejl = true;\n          set_in_iter_mejl = true;\n        }\n        else if(!set_in_iter_mejl)  this.postoji_mejl  = false;\n      \n    }\n    )\n    return ;\n  }\n\n  azuriraj_ulogovan(prof){\n    console.log(\"alskesa\")\n    this.ulogovan.dodatno['naziv'] = this.naziv;\n    this.ulogovan.dodatno['adresa'] = this.adresa;\n    this.ulogovan.dodatno['opis'] = this.opis;\n    this.ulogovan.br_telefona = this.telefon;\n    this.ulogovan.imejl = this.mejl\n    this.ulogovan.profilna_slika = prof;\n    localStorage.removeItem(\"agencija\");\n   \n    localStorage.setItem(\"agencija\", JSON.stringify(this.ulogovan));\n    this.broadcastService.azurirajUlogovanog.next({ status: 1 });\n    this.ngOnInit();\n    this.uploadedFiles = null;\n    this.imageSrc = null;\n    setTimeout(()=>{\n      this.poruka_o_stanju = null\n    }, 5000)\n \n  }\n\n  obrisi_sliku(){\n    this.http.get('http://localhost:4000/brisanje_slike/'+this.ulogovan.profilna_slika).subscribe((res)=>{\n    })\n    this.korisnikService.azuriraj_agenciju(this.ulogovan.korisnicko_ime,this.naziv, this.adresa, this.opis, this.ulogovan.dodatno['maticni_broj'], this.telefon, this.mejl, \"\").subscribe(respObj=>{\n    })\n    this.azuriraj_ulogovan(\"\")\n  }\n  async azuriraj(){\n    if(((this.postoji_mejl)  || !this.naziv || !this.adresa || !this.opis || !this.telefon || !this.mejl ||!this.format_mejl() || this.img_err)){\n      this.greska = \"Неисправно унети подаци!\";\n      console.log((this.postoji_mejl) )\n      console.log(!(this.naziv) )\n      console.log(!(this.adresa) )\n      console.log(!(this.opis) )\n      console.log(!(this.telefon) )\n      console.log(!(this.mejl) )\n      console.log(!this.format_mejl())\n      console.log(this.img_err)\n      return;\n    }\n\n    this.slanje_u_toku = true;\n    if(this.uploadedFiles){\n      if(this.uploadedFiles.length!=0){\n        interface responseExtended extends Response{\n          fileName:any;\n        }\n        let formData = new FormData();\n        for (var i = 0; i < this.uploadedFiles.length; i++) {\n            formData.append(\"uploads[]\", this.uploadedFiles[i], this.uploadedFiles[i].name);\n        }\n        \n      \n       \n        await this.http.post('http://localhost:4000/fajlovi/otpremanje', formData)\n            .subscribe(async (response : responseExtended) => {\n                if(this.ulogovan.profilna_slika!='')await this.http.get('http://localhost:4000/brisanje_slike/'+this.ulogovan.profilna_slika).subscribe();\n                this.filename_server =  response.fileName;\n                this.korisnikService.azuriraj_agenciju(this.ulogovan.korisnicko_ime,this.naziv, this.adresa, this.opis, this.ulogovan.dodatno['maticni_broj'], this.telefon, this.mejl, this.filename_server).subscribe(async respObj=>{\n                  if(respObj['message']==\"ok\") {\n                    window.scroll({ \n                      top: 0, \n                      left: 0, \n                      behavior: 'smooth' \n                    });\n                    this.slanje_u_toku = false;\n                    this.poruka_o_stanju = \"Подаци успешно ажурирани\";\n                    this.azuriraj_ulogovan(this.filename_server)\n                  }\n                });\n            })\n      }\n      else{\n\n        this.korisnikService.azuriraj_agenciju(this.ulogovan.korisnicko_ime, this.naziv, this.adresa, this.opis, this.ulogovan.dodatno['maticni_broj'], this.telefon, this.mejl, this.ulogovan.profilna_slika).subscribe(async respObj=>{\n          if(respObj['message']==\"ok\") {\n            window.scroll({ \n              top: 0, \n              left: 0, \n              behavior: 'smooth' \n            });\n            this.slanje_u_toku = false;\n            this.poruka_o_stanju = \"Подаци успешно ажурирани\";\n            this.azuriraj_ulogovan(this.ulogovan.profilna_slika)\n          }else{\n          }\n        });\n      }\n    }else{\n\n    this.korisnikService.azuriraj_agenciju(this.ulogovan.korisnicko_ime,this.naziv, this.adresa, this.opis, this.ulogovan.dodatno['maticni_broj'], this.telefon, this.mejl,  this.ulogovan.profilna_slika).subscribe(async respObj=>{\n      if(respObj['message']==\"ok\") {\n        window.scroll({ \n          top: 0, \n          left: 0, \n          behavior: 'smooth' \n        });\n        this.slanje_u_toku = false;\n        this.poruka_o_stanju = \"Подаци успешно ажурирани\";\n        this.azuriraj_ulogovan(this.ulogovan.profilna_slika)\n      }\n    });\n  }\n  }\n\n}\n\n"]},"metadata":{},"sourceType":"module"}