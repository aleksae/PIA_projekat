{"version":3,"file":"errors.js","names":["ApiTimeout","Error","constructor","Object","setPrototypeOf","new","target","prototype","http_code","name","AuthenticationError","message","ActionNotAllowed","UrlAlreadyRegistered","NotFoundError","ErrorWithBody","error","body","ValidationError","TooManyRequestsError","BadGateway","ApiError","ValueError","determineError","err","type","errorJSON","json","undefined","then","data","keys","length","status"],"sources":["../../src/services/errors.js"],"sourcesContent":["/* eslint-disable camelcase */\r\n/* eslint-disable max-classes-per-file */\r\n/**\r\n * Error raised for pre-api value validation\r\n *\r\n * @export\r\n * @class ApiTimeout\r\n * @extends {Error}\r\n */\r\nexport class ApiTimeout extends Error {\r\n    constructor() {\r\n        super('ApiTimeout');\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.http_code = 408;\r\n        this.name = 'ApiTimeout';\r\n    }\r\n}\r\n\r\n/**\r\n * AuthenticationError\r\n *\r\n * @export\r\n * @class AuthenticationError\r\n * @extends {Error}\r\n */\r\nexport class AuthenticationError extends Error {\r\n    constructor(message) {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.http_code = 401;\r\n        this.name = 'AuthenticationError';\r\n    }\r\n}\r\n\r\n/**\r\n * ActionNotAllowed\r\n *\r\n * @export\r\n * @class ActionNotAllowed\r\n * @extends {Error}\r\n */\r\nexport class ActionNotAllowed extends Error {\r\n    constructor(message = 'ActionNotAllowed') {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.http_code = 403;\r\n        this.name = 'ActionNotAllowed';\r\n    }\r\n}\r\n\r\n/**\r\n * UrlAlreadyRegistered\r\n *\r\n * @export\r\n * @class UrlAlreadyRegistered\r\n * @extends {Error}\r\n */\r\nexport class UrlAlreadyRegistered extends Error {\r\n    constructor(message = 'UrlAlreadyRegistered') {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.http_code = 409;\r\n        this.name = 'UrlAlreadyRegistered';\r\n    }\r\n}\r\n\r\n/**\r\n * NotFoundError\r\n *\r\n * @export\r\n * @class NotFoundError\r\n * @extends {Error}\r\n */\r\nexport class NotFoundError extends Error {\r\n    constructor(message = 'NotFoundError') {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.http_code = 404;\r\n        this.name = 'NotFoundError';\r\n    }\r\n}\r\n\r\n/**\r\n * UnprocessableError\r\n *\r\n * @export\r\n * @class UnprocessableError\r\n * @extends {Error}\r\n */\r\n// export class UnprocessableError extends Error {\r\n//     constructor(message = 'UnprocessableError') {\r\n//         UnprocessableError.http_code = 400;\r\n//         super(message);\r\n//         Object.setPrototypeOf(this, new.target.prototype);\r\n//         this.name = UnprocessableError.name;\r\n//     }\r\n// }\r\n\r\n/**\r\n * ValidationError\r\n *\r\n * @export\r\n * @class ValidationError\r\n * @extends {Error}\r\n */\r\nexport class ErrorWithBody extends Error {\r\n    constructor(http_code, error, message) {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.name = message;\r\n        this.http_code = http_code;\r\n        this.body = error;\r\n    }\r\n}\r\n\r\n/**\r\n * ValidationError\r\n *\r\n * @export\r\n * @class ValidationError\r\n * @extends {Error}\r\n */\r\nexport class ValidationError extends ErrorWithBody {\r\n    constructor(error, message = 'ValidationError') {\r\n        super(422, error, message);\r\n    }\r\n}\r\n\r\n/**\r\n * TooManyRequestsError\r\n *\r\n * @export\r\n * @class TooManyRequestsError\r\n * @extends {Error}\r\n */\r\nexport class TooManyRequestsError extends ErrorWithBody {\r\n    constructor(error, message = 'TooManyRequestsError') {\r\n        super(429, error, message);\r\n    }\r\n}\r\n\r\n/**\r\n * BadGateway\r\n *\r\n * @export\r\n * @class BadGateway\r\n * @extends {Error}\r\n */\r\nexport class BadGateway extends Error {\r\n    constructor() {\r\n        super('Bad gateway');\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.name = 'Bad gateway';\r\n        this.http_code = 502;\r\n    }\r\n}\r\n\r\n/**\r\n * ApiError\r\n *\r\n * @export\r\n * @class HttpError\r\n * @extends {Error}\r\n */\r\nexport class ApiError extends Error {\r\n    constructor(http_code, message) {\r\n        super('API Error');\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.name = 'API Error';\r\n        this.http_code = http_code;\r\n        this.body = message;\r\n    }\r\n}\r\n\r\n/**\r\n * ValueError\r\n *\r\n * @export\r\n * @class ValueError\r\n * @extends {Error}\r\n */\r\nexport class ValueError extends Error {\r\n    constructor(message) {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.name = 'ValueError';\r\n        this.body = message;\r\n    }\r\n}\r\n\r\nexport const determineError = async (err) => {\r\n    // Fot time outs\r\n    if (err.type === 'request-timeout') {\r\n        return new ApiTimeout();\r\n    }\r\n\r\n    if (err instanceof ValueError) {\r\n        throw err;\r\n    }\r\n\r\n    // For 'no body' response, replace with empty object\r\n    let errorJSON = err.json !== undefined ? await err.json.then((data) => data) : {};\r\n    if (Object.keys(errorJSON).length === 0 && err.message) {\r\n        errorJSON = err.message;\r\n    }\r\n\r\n    switch (err.status) {\r\n        case 401:\r\n            return new AuthenticationError();\r\n        case 404:\r\n            return new NotFoundError();\r\n        case 403:\r\n            return new ActionNotAllowed();\r\n        case 409:\r\n            return new UrlAlreadyRegistered();\r\n        case 422:\r\n            return new ValidationError(await errorJSON);\r\n        case 429:\r\n            return new TooManyRequestsError(await errorJSON);\r\n        case 502:\r\n            return new BadGateway();\r\n        default: {\r\n            return new ApiError(err.status, await errorJSON);\r\n        }\r\n    }\r\n};\r\n"],"mappings":"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"}